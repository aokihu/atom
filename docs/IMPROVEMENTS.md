# Atom 改良清单与优化进展

## 分析基线（2026-02-27）

本次分析基于以下实际检查结果：

- `bun run typecheck`：通过
- `bun run test`：通过（252/252）
- `Playground` 工作区启动验证：
  - 命令：`bun run src/index.ts --mode server --workspace ./Playground --http-port 8878`
  - 结果：`GET /healthz` 正常返回 `ok=true`

## 当前项目情况

- 架构分层清晰：`clients -> channel -> runtime -> agent` 边界明确，且有文档约束。
- 自动化覆盖较高：已有较完整单测，涉及 runtime、tools、config、TUI、Telegram、MCP。
- 配置能力成熟：支持多 provider、MCP server、工具权限、Telegram 通道。
- 主要短板在“工程治理”：文档版本同步、启动性能、敏感配置治理、CI 自动守护。

## 需要改良的部分（按优先级）

### P0（优先处理）

1. 文档与实现长期不同步
- 现象：README 曾停留在旧版本叙述，难以作为单一真相源。
- 影响：新成员接入成本高，误操作风险增加。
- 建议：每次发布强制同步 README 与 `docs/`；在 CI 增加文档一致性检查（例如版本号、模式列表、工具列表）。

2. 敏感信息治理缺少防线
- 现象：工作区配置易混入密钥类字段。
- 影响：泄露风险高，且后续旋转成本大。
- 建议：
  - 提供 `agent.config.example.json`；
  - 在 `.gitignore` 与 pre-commit/CI 增加密钥扫描；
  - 文档统一要求使用环境变量注入敏感字段。

### P1（建议近期处理）

3. 启动阶段仍有可优化空间
- 现象：工作区准备、MCP 初始化会增加冷启动时间。
- 影响：本地迭代反馈慢，用户感知“启动重”。
- 建议：
  - 对工作区初始化做并行、幂等处理（本次已落地）；
  - 对易失败 MCP server 引入更明确的超时策略与延迟初始化开关。

4. TODO 数据生命周期策略不够明确
- 现象：当前启动会清理 TODO DB（行为可用但语义偏“重置型”）。
- 影响：跨会话任务连续性较弱。
- 建议：引入开关或迁移策略，区分“迁移清理”与“常规启动”。

### P2（中期优化）

5. 发布流程缺少标准化
- 现象：版本升级、文档更新、回归验证依赖人工约定。
- 影响：容易出现遗漏。
- 建议：建立发布脚本（版本升级 + 校验 + CHANGELOG 片段生成）。

6. 启动性能可观测性不足
- 现象：有阶段日志，但缺少稳定指标基线。
- 影响：难以量化优化收益。
- 建议：记录各启动阶段耗时统计并纳入 CI 基准报告。

## 本轮已完成优化

1. `workspace_check` 启动优化
- 改动：由串行存在性检查改为并行幂等创建（`COPYFILE_EXCL + mkdir({ recursive: true })`）。
- 收益：减少文件系统往返；并发启动时更稳（避免覆盖已存在文件）。

2. 回归测试补齐
- 新增 `workspace_check` 单测：
  - 缺失文件/目录会自动创建；
  - 已有 `AGENT.md` 与 `agent.config.json` 不会被覆盖。

3. 文档同步
- README 已与当前 `0.10.x` 实现和运行方式对齐。

## 下一步执行建议

1. 在 CI 增加密钥扫描与文档一致性校验。
2. 评估 TODO DB 启动清理策略，明确是否改为可配置。
3. 为 MCP 初始化增加超时与可选懒加载策略，缩短冷启动路径。
